<!DOCTYPE html>
<html>

<head>
	<title>Ingenious Admin</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="./component/pear/css/pear.css" />
	<link rel="stylesheet" href="./admin/css/admin.css" />
	<link rel="stylesheet" href="./admin/css/admin.dark.css" />
	<link rel="stylesheet" href="./admin/css/variables.css" />
	<link rel="stylesheet" href="./admin/css/reset.css" />
</head>
<!-- 结 构 代 码 -->

<body class="layui-layout-body pear-admin">
	<!-- 布 局 框 架 -->
	<div class="layui-layout layui-layout-admin">
		<!-- 顶 部 样 式 -->
		<div class="layui-header">
			<!-- 菜 单 顶 部 -->
			<div class="layui-logo">
				<!-- 图 标 -->
				<img class="logo">
				<!-- 标 题 -->
				<span class="title"></span>
			</div>
			<!-- 顶 部 左 侧 功 能 -->
			<ul class="layui-nav layui-layout-left">
				<li class="collapse layui-nav-item"><a href="#" class="layui-icon layui-icon-shrink-right"></a></li>
				<li class="refresh layui-nav-item"><a href="#" class="layui-icon layui-icon-refresh-1" loading=600></a>
				</li>
			</ul>
			<!-- 多 系 统 菜 单 -->
			<div id="control" class="layui-layout-control"></div>
			<!-- 顶 部 右 侧 菜 单 -->
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item layui-hide-xs"><a href="#"
						class="menuSearch layui-icon layui-icon-search"></a></li>
				<li class="layui-nav-item layui-hide-xs message"></li>
				<li class="layui-nav-item layui-hide-xs"><a href="#"
						class="fullScreen layui-icon layui-icon-screen-full"></a></li>
				<li class="layui-nav-item user">
					<!-- 头 像 -->
					<a class="layui-icon layui-icon-username" href="javascript:;"><span id="user-name"></span></a>
					<!-- 功 能 菜 单 -->
					<dl class="layui-nav-child">
						<dd><a user-menu-url="view/setting/system_admin/person.html" user-menu-id="5555"
								user-menu-title="基本资料" menu-open-type="_layer" id="admin-home-page-person">基本资料</a></dd>
						<dd><a href="javascript:void(0);" class="logout">注销登录</a></dd>
					</dl>
				</li>
				<!-- 主 题 配 置 -->
				<li class="layui-nav-item setting"><a href="#" class="layui-icon layui-icon-more-vertical"></a></li>
			</ul>
		</div>
		<!-- 侧 边 区 域 -->
		<div class="layui-side layui-bg-black">
			<!-- 菜 单 顶 部 -->
			<div class="layui-logo">
				<!-- 图 标 -->
				<img class="logo">
				<!-- 标 题 -->
				<span class="title"></span>
			</div>
			<!-- 菜 单 内 容 -->
			<div class="layui-side-scroll">
				<div id="side"></div>
			</div>
		</div>
		<!-- 视 图 页 面 -->
		<div class="layui-body">
			<!-- 内 容 页 面 -->
			<div id="content"></div>
		</div>
		<!-- 页脚 -->
		<div class="layui-footer layui-text"></div>
		<!-- 遮 盖 层 -->
		<div class="pear-cover"></div>
		<!-- 加 载 动 画 -->
		<div class="loader-wrapper">
			<!-- 动 画 对 象 -->
			<div class="loader"></div>
		</div>
	</div>
	<!-- 移 动 端 便 捷 操 作 -->
	<div class="pear-collapsed-pe collapse">
		<a href="#" class="layui-icon layui-icon-shrink-right"></a>
	</div>
	<!-- 依 赖 脚 本 -->
	<script src="./component/layui/layui.js"></script>
	<script src="./component/pear/pear.js"></script>
	<script src="./config/config.js"></script>
	<script src="./config/common.js"></script>
	<script src="./config/permission.js"></script>
	<!-- 框 架 初 始 化 -->
	<script>
		layui.use(['admin', 'jquery', 'popup','common'], function () {
			var common=layui.common;
			var admin = layui.admin;
			var popup = layui.popup;
			var $ = layui.jquery;

			if (!checkLogin()) {
				popup.success("请登录", function () {
					checkLogin({ nav: true });
					location.href = './login.html';
				});
				return;
			}

			// yml | json | api
			admin.setConfigurationPath("config/pear.config.yml");

			// 渲染
			admin.render();

			// 注销
			admin.logout(function () {
				popup.success("注销成功", function () {
					location.href = "./login.html";
				})

				popup.success("注销成功", function () {
					layui.$.ajax({
						url: LOGOUT_API,
						type: "get", //请求方式
						data: {},
						dataType: 'json',
						success: function (ret) {

						},
						error: function (ret) {
							alert("出错" + ret.status + "：" + ret.responseText);
						},
						complete: function (ret) {
							setUserInfo(null);
							return new Promise((resolve) => {
								resolve(true)
							});
							location.href = "./login.html";
						}
					})
				})
				return true;

			});

			//赋值首页用户名称
			let userInfo = getUserInfo()
			if (userInfo) {
				let data = userInfo.info !== undefined ? userInfo.info : {};
				let realName = data.real_name !== undefined ? data.real_name : '';
				$('#user-name').html('&nbsp;' + realName);
			}

			function checkIfLoggedIn() {
				const isLoggedIn = sessionStorage.getItem('userLoggedIn');
				if (isLoggedIn == '' || isLoggedIn == null || isLoggedIn == undefined) {
					layer.open({
						type: 2,
						maxmin: false,
						title: '授权检测',
						closeBtn:0,
						area: [common.isModile() ? '100%' : '400px', common.isModile() ? '100%' : '180px'],
						content: 'view/start/index.html'
					});

				}
			}

			// checkIfLoggedIn()

		})
	</script>
</body>

</html>