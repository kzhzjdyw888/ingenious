<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增流程类型</title>
    <link rel="stylesheet" href="../../../component/pear/css/pear.css"/>
    <link rel="stylesheet" href="../../../admin/css/reset.css"/>
</head>
<body>

<form class="layui-form" action="" lay-filter="category-add-data-form">

    <div class="mainBox">
        <div class="main-container mr-5">
            <div class="layui-form-item">
                <label class="layui-form-label required">类别名称</label>
                <div class="layui-input-block">
                    <input type="text" name="name" required lay-verify="required" autocomplete="off" class="layui-input" placeholder="请输入名称">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排序</label>
                <div class="layui-input-block">
                    <input type="number" name="sort" min="0" autocomplete="off" class="layui-input" value="10">
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea placeholder="" class="layui-textarea" name="remark"></textarea>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom">
        <div class="button-container">
            <button type="submit" class="pear-btn pear-btn-primary pear-btn-md" lay-submit=""
                    lay-filter="save">
                保存
            </button>
            <button type="reset" class="pear-btn pear-btn-md">
                重置
            </button>
        </div>
    </div>
</form>
<script src="../../../component/layui/layui.js"></script>
<script src="../../../component/pear/pear.js"></script>
<script src="../../../config/common.js"></script>
<script src="../../../config/permission.js"></script>
<script src="../../../config/config.js"></script>
<script>


    const PRIMARY_KEY = "id";
    const READ_API = config.api_url + "/adminapi/wf/category/detail";
    const SAVE_API = config.api_url + "/adminapi/wf/category/save";
    const UPDATE_API = config.api_url + "/adminapi/wf/category/update";

    // 字段设置
    layui.use(["common", "popup", "form", "jquery"], function () {
        let popup = layui.popup;
        let form = layui.form;
        let $ = layui.jquery;


        if (getQueryString('operation') == 'add') {
            let pid = getQueryString('pid')
        }

        if (getQueryString('operation') == 'edit') {
            get()
            layui.$("button[type='reset']").click(function () {
                location.reload();
            })
            form.render()
        }


        /**
         * 表单提交
         */
        form.on("submit(save)", function (data) {
            if (getQueryString('operation') == 'edit') {
                data.field[PRIMARY_KEY] = getQueryString(PRIMARY_KEY);
            }
            layui.$.ajax({
                url: getQueryString('operation') == 'add' ? SAVE_API : UPDATE_API,
                type: 'POST',
                dateType: "json",
                data: data.field,
                success: function (ret) {
                    if (ret.status == 200) {``
                        popup.success(ret.msg, function () {
                            parent.refreshTable();
                            parent.layer.close(parent.layer.getFrameIndex(window.name));
                        });
                    } else {
                        popup.failure(ret.msg);
                    }
                }
            });
            return false;
        });

        function get() {
            layui.$.ajax({
                    url: READ_API,
                    method: 'GET',
                    dataType: 'JSON',
                    data: {id: getQueryString(PRIMARY_KEY)},
                    success: function (ret) {
                        if (ret.status === 200) {
                            let data = ret.data;
                            form.val("category-add-data-form", data)
                            form.render();
                        }
                    },
                    error: function (ret) {
                        alert("出错" + ret.status + "：" + ret.responseText);
                    }
                }
            );
        }

    });


</script>

</body>
</html>
