<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>属性面板</title>
    <link rel="stylesheet" href="../../../../../component/pear/css/pear.css"/>
    <link rel="stylesheet" href="../../../../../admin/css/reset.css"/>
</head>

<body>
<div class="layui-tab layui-tab-brief layui-form" lay-filter="setting-form" id="setting-form">
    <ul class="layui-tab-title">
        <li class="layui-this" lay-id="1">流程属性</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            <div class="main-container">
                <h5>基本属性</h5>
                <div class="layui-form-item">
                    <label class="layui-form-label">唯一编码:</label>
                    <div class="layui-input-block">
                        <input type="text" lay-verify="required" placeholder="" autocomplete="off" name="name"
                               class="layui-input" readonly>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">显示名称:</label>
                    <div class="layui-input-block">
                        <input type="text" lay-verify="required" placeholder="" autocomplete="off"
                               name="display_name" class="layui-input" readonly>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">期望时间:</label>
                    <div class="layui-input-block">
                        <input type="text" lay-verify="required" placeholder="" autocomplete="off"
                               name="expire_time" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">表单url:</label>
                    <div class="layui-input-block">
                        <select name="instance_url" lay-filter="instance_url">
                            <option value="">请选择</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--layui依赖-->
<script src="../../../../../component/layui/layui.js"></script>
<script src="../../../../../component/pear/pear.js"></script>
<script src="../../../../../config/common.js"></script>
<script src="../../../../../config/config.js"></script>
<script src="../../../../../config/permission.js"></script>
<script src="../../../../../component/logicflow/customized/properties.js"></script>
<script>
    const PROCESS_APPROVE_FORM_API = config.api_url + "/adminapi/wf/other/form/option";
    window.child = function (obj) {
        layui.use(['element', 'jquery', 'form'], function () {
            let $ = layui.jquery;
            let form = layui.form;
            let newObj = initializationData(obj)

            //渲染单据
            getForms()
            form.val('setting-form', newObj)
            form.render();

            /**
             * 监听input change事件
             */
            $(function () {
                $("#setting-form input").off("change").change(function () {
                    let newData = form.val('setting-form');
                    newData.type = 'ingenious:process'
                    propertyKeysSet(newData)
                })
            })


            function getForms() {
                let selectElem = $('select[name="instance_url"]');
                $.ajax({
                    url: PROCESS_APPROVE_FORM_API,
                    type: 'GET',
                    dataType: 'json',
                    async: false,
                    success: function (ret) {
                        let data = ret.data != undefined ? ret.data : [];
                        $.each(data, function (index, item) {
                            let option = '<option value="' + item.value + '">' + item.label + '</option>';
                            selectElem.append(option);
                        });
                    },
                    error: function (ret) {
                    }
                });
            }

            form.on('select(instance_url)', function (data) {
                let newData = form.val('setting-form');
                newData.type = 'ingenious:process'
                propertyKeysSet(newData)
            });
        })
    };
</script>


</body>

</html>