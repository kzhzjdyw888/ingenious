<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>工作台</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../admin/css/other/console.css"/>
</head>

<body>
<div class="pear-container">
    <div class="layui-row layui-col-space10">
        <div class="layui-col-md8">
            <div class="layui-row layui-col-space10">
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            快捷菜单
                        </div>
                        <div class="layui-card-body">
                            <div class="layui-row layui-col-space10">
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="170320e1-d592-4809-9447-f40b27fc7aa9" data-title="我的待办"
                                         data-url="view/wf/task/todo">
                                        <i class="layui-icon layui-icon-date"></i>
                                    </div>
                                    <span class="shortcut-menu-label">待办</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="94d4cd83-3d89-493d-97ba-27ded6503a8f" data-title="我的已办"
                                         data-url="view/wf/task/done">
                                        <i class="layui-icon layui-icon-note"></i>
                                    </div>
                                    <span class="shortcut-menu-label">已办</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="0efa9244-f4b0-45a6-8781-cac2fff19abe" data-title="我的抄送"
                                         data-url="view/carbon">
                                        <i class="layui-icon layui-icon-star"></i>
                                    </div>
                                    <span class="shortcut-menu-label">抄送</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="59ca4011-f611-4514-a7ac-a404228e2e73" data-title="发起申请"
                                         data-url="view/wf/instance/startProcess.html">
                                        <i class="layui-icon layui-icon-release"></i>
                                    </div>
                                    <span class="shortcut-menu-label">发起</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="3e2df7be-9e8c-4ce2-9ddb-61f13d3142bf" data-title="表单构建"
                                         data-url="view/system/maintain/form_build">
                                        <i class="layui-icon layui-icon-form"></i>
                                    </div>
                                    <span class="shortcut-menu-label">表单</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="4474d199-7089-4efb-bc68-b638a7aef300" data-title="流程设计"
                                         data-url="view/wf/designer">
                                        <i class="layui-icon layui-icon-template"></i>
                                    </div>
                                    <span class="shortcut-menu-label">设计</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="d6c3dc71-a5a4-4468-bd6c-4c92c24d098b" data-title="我发起的"
                                         data-url="view/wf/instance">
                                        <i class="layui-icon layui-icon-log"></i>
                                    </div>
                                    <span class="shortcut-menu-label">追踪</span>
                                </div>
                                <div class="layui-col-md3 layui-col-sm3 layui-col-xs3">
                                    <div class="shortcut-menu" data-id="e0db89ff-5832-4057-83a1-afb3af069b5e" data-title="我的收藏"
                                         data-url="view/wf/favorite">
                                        <i class="layui-icon layui-icon-star-fill"></i>
                                    </div>
                                    <span class="shortcut-menu-label">收藏</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">
                            代办任务
                        </div>
                        <div class="layui-card-body">
                            <div class="layui-row layui-col-space10">
                                <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                                    <div class="deputy">
                                        <div class="deputy-label">我的待办</div>
                                        <div class="deputy-count">21</div>
                                    </div>
                                </div>
                                <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                                    <div class="deputy">
                                        <div class="deputy-label">我的已办</div>
                                        <div class="deputy-count">63</div>
                                    </div>
                                </div>
                                <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                                    <div class="deputy">
                                        <div class="deputy-label">我的待阅</div>
                                        <div class="deputy-count">32</div>
                                    </div>
                                </div>
                                <div class="layui-col-md6 layui-col-sm6 layui-col-xs6">
                                    <div class="deputy">
                                        <div class="deputy-label">我的申请</div>
                                        <div class="deputy-count">14</div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md12">
                    <!--                    图表-->
                    <!--                    <div class="layui-card">-->
                    <!--                        <div class="layui-card-body">-->
                    <!--                            <div class="layui-tab custom-tab layui-tab-brief" lay-filter="docDemoTabBrief">-->
                    <!--                                <div id="echarts-records-1" style="height:400px;"></div>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                    <!--                    表格-->
                    <div class="layui-card">
                        <div class="layui-card-body" style="padding-top: 15px; padding-bottom: 15px;">
                            <table class="layui-hide" id="console-home-table-data"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md4">
            <div class="layui-card">
                <div class="layui-card-header">留言板</div>
                <div class="layui-card-body">
                    <ul class="message-board">
                        <li>
                            <p>要不要作为我的家人，搬来我家。</p>
                            <span></span>
                        </li>
                        <li>
                            <p>快乐的时候不敢尽兴，频繁警戒自己保持清醒。</p>
                        </li>
                        <li>
                            <p>夏天真的来了，尽管它还有些犹豫。</p>
                        </li>
                        <li>
                            <p>Ingenious 工作流引擎，尽管它还有些犹豫。</p>
                            <!-- <a href="https://gitee.com/liu_guan_qing/workingflower" target="_blank" rel="noopener noreferrer"><i class="layui-icon layui-icon-github"></i>https://gitee.com/liu_guan_qing</a> -->
                            <!--                            <a href="javascript:;" data-id="1" class="layui-btn layui-btn-primary layui-btn-xs message-board-reply">回复</a>-->
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="console-home-table-sex">
    {{#if (d.sex == 1) { }}
    <span>男</span>
    {{# }else if(d.sex == 2){ }}
    <span>女</span>
    {{# } }}
</script>
<script type="text/html" id="console-home-table-bar">
    <button class="pear-btn pear-btn-xs tool-btn" lay-event="act">
        <i class="layui-icon layui-icon-username"></i>扮演用户
    </button>
</script>

<script src="../../config/common.js"></script>
<script src="../../config/permission.js"></script>
<script src="../../config/config.js"></script>
<script>
    const DEMOD_USER_LIST_API = config.api_url + "/adminapi/demo/user/page";
    const DEMOD_USER_ACT_API = config.api_url + "/adminapi/demo/user/act";
    layui.use(['admin', 'layer', 'table', 'button', 'popup'], function () {
        let $ = layui.jquery;
        let table = layui.table;
        let button = layui.button;
        let popup = layui.popup;
        let admin = layui.admin;
        let cols = [
            {
                title: '账号',
                field: 'account',
                align: 'left',
                width: 150
            },
            {
                title: '姓名',
                field: 'real_name',
                align: 'left',
                width: 150
            },
            {
                title: '性别',
                field: 'sex',
                align: 'center',
                templet: '#console-home-table-sex',
                width: 70
            },
            {
                title: '部门',
                field: 'dept_name',
                align: 'left',
                minWidth: 100
            },
            {
                title: '职位',
                field: 'post_name',
                align: 'left',
                minWidth: 100
            },

            {
                title: '最后一次登录',
                field: 'cell_phone_number',
                align: 'left',
                width: 140,
                hide: true
            },
            {
                title: '最后一次登录ip',
                field: 'orgz',
                align: 'left',
                width: 100,
                hide: true
            },
            {
                title: '操作',
                toolbar: '#console-home-table-bar',
                align: "center",
                fixed: "right",
                minWidth: 190,
                width: 200,
            }
        ]

        function render() {
            table.render({
                elem: "#console-home-table-data",
                url: DEMOD_USER_LIST_API,
                page: true,
                cols: [cols],
                skin: "line",
                limit: 10,
                limits: [10, 20, 30, 40, 50, 100],
                autoSort: false,
                parseData: function (ret) {
                    return {
                        "code": ret.status === 200 ? 0 : -1, // 解析接口状态
                        "msg": ret.msg, // 解析提示文本
                        "count": ret.data.count, // 解析数据长度
                        "data": ret.data.list // 解析数据列表
                    };
                },
                defaultToolbar: [{
                    title: "刷新",
                    layEvent: "refresh",
                    icon: "layui-icon-refresh",
                }, "filter", "print", "exports"]
            })
        }

        table.on('tool(console-home-table-data)', function (obj) {
            if (obj.event === 'act') {
                actUser(obj.data)
            }
        });

        /**
         * 用户扮演
         * @param data
         */
        function actUser(data) {
            layui.$.ajax({
                    url: DEMOD_USER_ACT_API,
                    type: 'post',
                    dataType: 'json',
                    data: {account: data['account']},
                    success: function (ret) {
                        if (ret && ret.status == 200) {
                            sessionStorage.clear();
                            //重写本地存储
                            setUserInfo({
                                'isLogin': true,
                                "token": ret.data.token,
                                'info': ret.data['user_info'],
                                'menus': ret.data['menus'],
                                'unique_auth': ret.data['unique_auth']
                            });
                            button.load({
                                elem: '.login',
                                time: 600,
                                done: function () {
                                    popup.success("扮演成功", function () {
                                        location.reload(true);
                                    });
                                }
                            });
                        } else {
                            layer.msg(ret.msg, {
                                icon: 2,
                                time: 1500
                            });
                        }
                    }
                }
            )
        }

        render();

        //快捷菜单跳转
        $("body").on("click", "[data-url]", function () {
            PearAdmin.changePage({
                id: $(this).attr("data-id"),
                title: $(this).attr("data-title"),
                url: $(this).attr("data-url"),
                type: "_component",//组建模式渲染
            });
        })
    })
    ;
</script>
</body>

</html>
